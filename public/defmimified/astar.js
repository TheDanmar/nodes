(function(l){"object"===typeof module&&"object"===typeof module.exports?module.exports=l():"function"===typeof define&&define.amd?define([],l):(l=l(),window.astar=l.astar,window.Graph=l.Graph)})(function(){function l(a){for(var b=[];a.parent;)b.unshift(a),a=a.parent;b.unshift(a);return b}function t(){return new n(function(a){return a.f})}function g(a,b){b=b||{};this.nodes=[];this.diagonal=!!b.diagonal;this.tor=!!b.tor;this.grid=[];for(b=0;b<a.length;b++){this.grid[b]=[];for(var c=0,e=a[b];c<e.length;c++){var d=
new m(b,c,e[c]);this.grid[b][c]=d;this.nodes.push(d)}}this.init()}function m(a,b,c){this.x=a;this.y=b;this.weight=c;this.bids=[];this.owner=null}function n(a){this.content=[];this.scoreFunction=a}var p={search:function(a,b,c,e){a.cleanDirty();e=e||{};var d=e.heuristic||p.heuristics.manhattan;e=e.closest||!1;var h=t(),k=b;b.h=d(b,c);a.markDirty(b);for(h.push(b);0<h.size();){b=h.pop();if(b===c)return l(b);b.closed=!0;for(var g=a.neighbors(b),m=0,n=g.length;m<n;++m){var f=g[m];if(!f.closed&&!f.isWall()){var q=
b.g+f.getCost(b),r=f.visited;if(!r||q<f.g)f.visited=!0,f.parent=b,f.h=f.h||d(f,c),f.g=q,f.f=f.g+f.h,a.markDirty(f),e&&(f.h<k.h||f.h===k.h&&f.g<k.g)&&(k=f),r?h.rescoreElement(f):h.push(f)}}}return e?l(k):[]},heuristics:{manhattan:function(a,b){return Math.abs(b.x-a.x)+Math.abs(b.y-a.y)},diagonal:function(a,b){var c=Math.abs(b.x-a.x);a=Math.abs(b.y-a.y);return 1*(c+a)+(Math.sqrt(2)-2)*Math.min(c,a)}},cleanNode:function(a){a.f=0;a.g=0;a.h=0;a.visited=!1;a.closed=!1;a.parent=null}};g.prototype.init=function(){this.dirtyNodes=
[];for(var a=0;a<this.nodes.length;a++)p.cleanNode(this.nodes[a])};g.prototype.cleanDirty=function(){for(var a=0;a<this.dirtyNodes.length;a++)p.cleanNode(this.dirtyNodes[a]);this.dirtyNodes=[]};g.prototype.markDirty=function(a){this.dirtyNodes.push(a)};g.prototype.neighbors=function(a){var b=[],c=a.x,e=a.y,d=this.grid;d[c-1]&&d[c-1][e]&&b.push(d[c-1][e]);d[c+1]&&d[c+1][e]&&b.push(d[c+1][e]);d[c]&&d[c][e-1]&&b.push(d[c][e-1]);d[c]&&d[c][e+1]&&b.push(d[c][e+1]);this.diagonal&&(d[c-1]&&d[c-1][e-1]&&
b.push(d[c-1][e-1]),d[c+1]&&d[c+1][e-1]&&b.push(d[c+1][e-1]),d[c-1]&&d[c-1][e+1]&&b.push(d[c-1][e+1]),d[c+1]&&d[c+1][e+1]&&b.push(d[c+1][e+1]));this.tor&&(console.log(a),c==d.length-1&&b.push(d[0][e]),0==c&&b.push(d[this.grid.length-1][e]),0==e&&b.push(d[c][d[0].length-1]),e==d[0].length-1&&b.push(d[c][0]));return b};g.prototype.toString=function(){for(var a=[],b=this.grid,c=0;c<b.length;c++){for(var e=[],d=b[c],h=0;h<d.length;h++)e.push(d[h].weight);a.push(e.join(" "))}return a.join("\n")};g.prototype.download=
function(){if(this.grid&&null!=this.grid){for(var a=[],b=0;b<this.grid.length;b++){for(var c=[],e=0;e<this.grid[0].length;e++)c.push(this.grid[b][e].weight);a.push(c)}b=JSON.stringify(a);a=document.createElement("a");b=new Blob([b],{type:"text/plain"});a.href=URL.createObjectURL(b);a.download=Date();a.click()}};m.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};m.prototype.getCost=function(a){return a&&a.x!=this.x&&a.y!=this.y?1.41421*this.weight:this.weight};m.prototype.isWall=function(){return 0===
this.weight};n.prototype={push:function(a){this.content.push(a);this.sinkDown(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return a},remove:function(a){var b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(a){this.sinkDown(this.content.indexOf(a))},
sinkDown:function(a){for(var b=this.content[a];0<a;){var c=(a+1>>1)-1,e=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(e))this.content[c]=b,this.content[a]=e,a=c;else break}},bubbleUp:function(a){for(var b=this.content.length,c=this.content[a],e=this.scoreFunction(c);;){var d=a+1<<1,h=d-1,k=null;if(h<b){var g=this.scoreFunction(this.content[h]);g<e&&(k=h)}d<b&&this.scoreFunction(this.content[d])<(null===k?e:g)&&(k=d);if(null!==k)this.content[a]=this.content[k],this.content[k]=c,a=k;else break}}};
return{astar:p,Graph:g}});
