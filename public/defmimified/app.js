var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
var canvas=document.getElementById("myCanvas"),ctx=canvas.getContext("2d"),cols,rows,xoffset,yoffset,graph,points=[],BLOCKEDPERCENT=0,paused=!1,yVelocity=0,xVelocity=0,stepSpeed=2E3,drawSpeed=stepSpeed/150,drawint=null,stepint=null,diagonal_state=!1,tor_state=!1,step=0;if("undefined"==typeof console)var console={log:function(){}};function onload(){console.log("Page loaded.");canvas.addEventListener("click",canvasClick,!1)}
$("#drawbutton").on("click",function(){cleanup();document.getElementById("points").innerHTML="";document.getElementById("points").hidden="true";pathFinding()});$("#updatebutton").on("click",function(){points=[];document.getElementById("points").innerHTML="";document.getElementById("points").hidden=!0;pathFinding()});$("#savebutton").on("click",function(){graph.download()});$("#pausebutton").on("click",function(){pause()});
$("#newpoint").on("click",function(){var a=parseInt(document.getElementById("fromN").value),b=parseInt(document.getElementById("fromM").value),c=parseInt(document.getElementById("toN").value),d=parseInt(document.getElementById("toM").value),e=parseInt(document.getElementById("delaybox").value);addPath(a,b,c,d,e)&&(document.getElementById("points").hidden=!1,document.getElementById("points").innerHTML="",document.getElementById("points").appendChild(makeUL(points)));document.getElementById("fromN").value=
"";document.getElementById("fromM").value="";document.getElementById("toM").value="";document.getElementById("toN").value="";document.getElementById("delaybox").value="";draw()});
$("#randomgraph").on("click",function(){var a=parseInt(document.getElementById("minlen").value),b=parseInt(document.getElementById("amount").value),c=parseInt(document.getElementById("delay").value);randomgr(a,b,c)&&(document.getElementById("points").hidden=!1,document.getElementById("points").innerHTML="",document.getElementById("points").appendChild(makeUL(points)));document.getElementById("minlen").value="";document.getElementById("amount").value="";document.getElementById("delay").value="";draw()});
function pathFinding(){graph&&null!=graph?(createCharts(),drawSpeed=Math.ceil(drawSpeed),drawint=setInterval(function(){paused?0:draw()},drawSpeed),stepint=setInterval(function(){paused||(movepoints(),charting(),step++,console.log("step "+step));document.getElementById("points").hidden=!1;document.getElementById("points").innerHTML="";document.getElementById("points").appendChild(makeUL(points))},stepSpeed)):(rows=parseInt(document.getElementById("nimput").value),cols=parseInt(document.getElementById("minput").value),
BLOCKEDPERCENT=parseFloat(document.getElementById("BLOCKEDPERCENT").value),0<rows&&0<cols&&0<=BLOCKEDPERCENT&&1>=BLOCKEDPERCENT&&(graph=createGraph(rows,cols,BLOCKEDPERCENT),pathFinding()))}
function createCharts(){var a=document.getElementById("myChart1").getContext("2d"),b=document.getElementById("myChart2").getContext("2d"),c=document.getElementById("myChart3").getContext("2d");myChartx1=new Chart(a,{type:"line",data:{labels:[],datasets:[{label:"Load",data:[],backgroundColor:["rgba(255, 99, 132, 0.2)"],borderColor:["rgba(255,99,132,1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}});myChartx2=new Chart(b,{type:"line",data:{labels:[],datasets:[{label:"avg speed drop",
data:[],backgroundColor:["rgba(80, 220, 100, 0.2)"],borderColor:["rgba(80, 220, 100 , 1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}});myChartx3=new Chart(c,{type:"line",data:{labels:[],datasets:[{label:"lost",backgroundColor:"rgba(255,0,0,0.2)",borderColor:"rgba(255,0,0,1)",data:[],fill:!1},{label:"cons",fill:!1,backgroundColor:"rgba(0,0,255,0.2)",borderColor:"rgba(0,0,255,1)",data:[]}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}
function charting(){function a(a,b,c){a.data.labels.push(b);a.data.datasets.forEach(function(a){a.data.push(c)});a.update()}for(var b=0,c=0,d=0,e=loses=0;e<points.length;e++)1>points[e].delay&&!points[e].ended&&(d++,b+=Math.round(100*points[e].path.length/(points[e].path.length+points[e].lost))/100),loses+=points[e].lost,c+=points[e].con;b/=d;a(myChartx1,step,d/graph.nodes.length);a(myChartx2,step,-1*(1-b));(function(a,b,c,d){a.data.labels.push(b);a.data.datasets[0].data.push(c);a.data.datasets[1].data.push(d);
a.update()})(myChartx3,step,loses,c)}
function movepoints(){graph.nodes.forEach(function(a){a.bids=[]});for(var a=0;a<points.length;a++)0<points[a].delay?points[a].delay--:(points[a].x=points[a].tox,points[a].y=points[a].toy,points[a].xc=points[a].toxc,points[a].yc=points[a].toyc);for(a=0;a<points.length;a++)0<points[a].delay?points[a].delay--:(points[a].x=points[a].tox,points[a].y=points[a].toy,points[a].xc=points[a].toxc,points[a].yc=points[a].toyc,points[a].path[points[a].currstp+1]?graph.grid[points[a].path[points[a].currstp+1].x][points[a].path[points[a].currstp+
1].y].bids.push(a):points[a].currstp++);graph.nodes.forEach(function(a){var c=null;1==a.bids.length&&(c=a.bids[0]);if(1<a.bids.length){c=a.bids[Math.floor(a.bids.length*Math.random())];for(var b=0;b<a.bids.length;b++)points[a.bids[b]].con++,console.log("kek"),a.bids[b]!=c?points[a.bids[b]].lost++:0}null!=c&&(points[c].tox=points[c].path[points[c].currstp+1].x,points[c].toy=points[c].path[points[c].currstp+1].y,points[c].toxc=points[c].tox*xoffset+xoffset/2,points[c].toyc=points[c].toy*yoffset+yoffset/
2,points[c].currstp++)})}
function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);(function(a){for(var b=0;b<a.nodes.length;b++)if(0<a.nodes[b].weight)for(var c=a.nodes[b].x*xoffset+xoffset/2,d=a.nodes[b].y*yoffset+yoffset/2,e=a.neighbors(a.nodes[b]),f=0;f<e.length;f++)0<e[f].weight&&(ctx.beginPath(),ctx.moveTo(c,d),ctx.lineTo(e[f].x*xoffset+xoffset/2,e[f].y*yoffset+yoffset/2),ctx.strokeStyle="#000",ctx.lineWidth=1,ctx.stroke(),ctx.closePath())})(graph);(function(a){a.forEach(function(a){for(var c=0;c<a.path.length-
1;c++)ctx.beginPath(),ctx.moveTo(a.path[c].x*xoffset+xoffset/2,a.path[c].y*yoffset+yoffset/2),ctx.lineTo(a.path[c+1].x*xoffset+xoffset/2,a.path[c+1].y*yoffset+yoffset/2),ctx.strokeStyle=a.color,ctx.lineWidth=5,ctx.stroke(),ctx.closePath()})})(points);(function(){for(var a=0;a<points.length;a++)0<points[a].delay||points[a].currstp==points[a].path.length||(points[a].x==points[a].toN&&points[a].y==points[a].toM&&(ctx.beginPath(),ctx.arc(points[a].toxc,points[a].toyc,20,0,2*Math.PI,!1),ctx.fillStyle=
"#006600",ctx.fill(),ctx.closePath()),ctx.beginPath(),ctx.arc(points[a].xc,points[a].yc,15,0,2*Math.PI,!1),ctx.fillStyle=points[a].color,ctx.fill(),ctx.closePath())})();(function(a){for(var b=0;b<a.nodes.length;b++)if(0<a.nodes[b].weight){var c=a.nodes[b].x*xoffset+xoffset/2,d=a.nodes[b].y*yoffset+yoffset/2;ctx.beginPath();ctx.arc(c,d,10,0,2*Math.PI,!1);ctx.fillStyle="#000000";ctx.fill();ctx.closePath()}})(graph);(function(a){for(var b=0;b<a.nodes.length;b++)if(0<a.nodes[b].weight){var c=a.nodes[b].x*
xoffset+xoffset/2,d=a.nodes[b].y*yoffset+yoffset/2;ctx.font="10px Arial";ctx.fillStyle="#ffffff";ctx.textAlign="center";ctx.fillText(b,c,d+4);ctx.font="10px Arial";ctx.fillStyle="#000000";ctx.textAlign="center";ctx.fillText("("+a.nodes[b].x+", "+a.nodes[b].y+")",c,d+20)}})(graph);(function(){points.forEach(function(a){Math.abs(a.toxc-a.xc)>=xVelocity?a.toxc>a.xc?a.xc+=xVelocity:a.xc-=xVelocity:a.x=a.tox;Math.abs(a.toyc-a.yc)>=yVelocity?a.toyc>a.yc?a.yc+=yVelocity:a.yc-=yVelocity:a.y=a.toy})})()}
function init(){cleanup();cols=rows=15;BLOCKEDPERCENT=0;graph=createGraph(rows,cols,BLOCKEDPERCENT);addPath(4,4,4,12,5);addPath(3,2,9,2);addPath(4,3,4,0);addPath(4,10,4,0);addPath(0,0,9,9);addPath(5,9,9,9);addPath(14,4,4,14);addPath(9,9,0,9);document.getElementById("points").hidden=!1;document.getElementById("points").innerHTML="";document.getElementById("points").appendChild(makeUL(points));pathFinding()}
function randomgr(a,b,c){if(!(1>a||1>b||0>c)){rows=Math.floor(15*Math.random())+5;cols=Math.floor(15*Math.random())+5;BLOCKEDPERCENT=.5*Math.random();graph=createGraph(rows,cols,BLOCKEDPERCENT);for(var d=0;points.length<b&&1E3>d;)addPath(Math.floor(cols*Math.random()),Math.floor(rows*Math.random()),Math.floor(cols*Math.random()),Math.floor(rows*Math.random()),c*Math.random())?points[points.length-1].path.length<a&&points.pop():d++;document.getElementById("points").hidden=!1;document.getElementById("points").innerHTML=
"";document.getElementById("points").appendChild(makeUL(points));pathFinding();return!0}}
function addPath(a,b,c,d,e){e=parseInt(e);if(!e||0>e)e=0;if(a<rows&&0<=a&&b<cols&&0<=b&&c<rows&&0<=c&&d<cols&&0<=d&&0<graph.grid[a][b].weight&&0<graph.grid[c][d].weight){var f=astar.search(graph,graph.grid[a][b],graph.grid[c][d]);if(f[0]){var g=getRandomColor();points.push({x:a,y:b,color:g,currstp:0,ended:!1,xc:a*xoffset+xoffset/2,yc:b*yoffset+yoffset/2,toxc:a*xoffset+xoffset/2,toyc:b*yoffset+yoffset/2,tox:a,toy:b,lost:0,con:0,delay:e,fromN:a,fromM:b,toN:c,toM:d,path:f});return!0}}return!1}
function createGraph(a,b,c){var d=[];if(0<=c&&1>c&&0<a&&0<b){xoffset=canvas.width/a;yoffset=canvas.height/b;yVelocity=Math.ceil(drawSpeed/yoffset);xVelocity=Math.ceil(drawSpeed/xoffset);for(var e=0;e<a;e++){for(var f=[],g=0;g<b;g++)f.push(Math.random()>c?1:0);d.push(f)}document.getElementById("updatebutton").disabled=!1;document.getElementById("newpoint").disabled=!1;document.getElementById("pointdev").hidden=!1;document.getElementById("options").hidden=!1;return new Graph(d,{diagonal:diagonal_state,
tor:tor_state})}return null}function cleanup(){points=[];graph=0;drawint&&clearInterval(drawint);stepint&&clearInterval(stepint)}function getRandomColor(){for(var a="#",b=0;6>b;b++)a+="123456789ABCDE"[Math.floor(14*Math.random())];return a}
function makeUL(a){for(var b=document.createElement("ul"),c=0;c<a.length;c++){var d=document.createElement("li"),e=document.createElement("div"),f=document.createElement("p");e.className="input-color";var g=document.createElement("div");g.className="color-box";g.style="background-color: "+a[c].color+";";f.appendChild(document.createTextNode("("+a[c].fromN+", "+a[c].fromM+")\u2192("+a[c].toN+", "+a[c].toM+") Lost = "+points[c].lost+", concur = "+points[c].con+", speed = "+Math.round(100*points[c].path.length/
(points[c].path.length+points[c].lost))/100));e.appendChild(f);e.appendChild(g);d.appendChild(e);b.appendChild(d)}return b}window.onkeydown=function(a){a=a.keyCode?a.keyCode:a.which;73===a&&init();80===a&&pause();83===a&&graph.download();71===a&&console.log(graph);82===a&&randomgr(10,10,5)};function pause(){paused=paused?!1:!0}
function canvasClick(a){if(void 0!=a.pageX&&void 0!=a.pageY){var b=a.pageX;a=a.pageY}else b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;b-=canvas.offsetLeft;a-=canvas.offsetTop;b=Math.floor(b/xoffset);a=Math.floor(a/yoffset);graph.grid[b][a].weight=0<graph.grid[b][a].weight?0:1}
document.getElementById("import").onclick=function(){var a=document.getElementById("selectFiles").files;if(0>=a.length)return!1;var b=new FileReader;b.onload=function(a){var b=[];a=JSON.parse(a.target.result);rows=a.length;cols=a[0].length;xoffset=canvas.width/rows;yoffset=canvas.height/cols;yVelocity=Math.ceil(drawSpeed/yoffset);xVelocity=Math.ceil(drawSpeed/xoffset);for(var c=0;c<rows;c++){for(var f=[],g=0;g<cols;g++)f.push(a[c][g]);b.push(f)}document.getElementById("updatebutton").disabled=!1;
document.getElementById("newpoint").disabled=!1;document.getElementById("pointdev").hidden=!1;document.getElementById("options").hidden=!1;graph=new Graph(b,{diagonal:diagonal_state});pathFinding()};b.readAsText(a.item(0))};$("#checkb1").click(function(){$(this).is(":checked")?(document.getElementById("checkb2").checked=!0,diagonal_state=document.getElementById("checkb3").checked=!0):(diagonal_state=!1,document.getElementById("checkb2").checked=!1,document.getElementById("checkb3").checked=!1)});
$("#checkb2").click(function(){$(this).is(":checked")?(document.getElementById("checkb1").checked=!0,diagonal_state=document.getElementById("checkb3").checked=!0):(diagonal_state=!1,document.getElementById("checkb1").checked=!1,document.getElementById("checkb3").checked=!1)});
$("#checkb3").click(function(){$(this).is(":checked")?(document.getElementById("checkb2").checked=!0,diagonal_state=document.getElementById("checkb1").checked=!0):(diagonal_state=!1,document.getElementById("checkb2").checked=!1,document.getElementById("checkb1").checked=!1)});
