var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,b,d){var c=this.length||0;0>b&&(b=Math.max(0,c+b));if(null==d||d>c)d=c;d=Number(d);0>d&&(d=Math.max(0,c+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}},"es6","es3");
var canvas=document.getElementById("myCanvas"),ctx=canvas.getContext("2d"),chartx1=document.getElementById("myChart1").getContext("2d"),chartx2=document.getElementById("myChart2").getContext("2d"),chartx3=document.getElementById("myChart3").getContext("2d"),myChartx1,cols,rows,xoffset,yoffset,paths=[],graph,collisions=[],points=[],BLOCKEDPERCENT=0,paused=!1,yVelocity=0,xVelocity=0,stepSpeed=2E3,drawSpeed=stepSpeed/150,drawint=null,stepint=null,diagonal_state=!1,step=0;
if("undefined"==typeof console)var console={log:function(){}};function onload(){console.log("Page loaded.");canvas.addEventListener("click",canvasClick,!1)}$("#drawbutton").on("click",function(){cleanup();document.getElementById("points").innerHTML="";document.getElementById("points").hidden="true";pathFinding()});$("#updatebutton").on("click",function(){paths=[];points=[];document.getElementById("points").innerHTML="";document.getElementById("points").hidden=!0;pathFinding()});
$("#savebutton").on("click",function(){download(graph.grid,"json.txt","text/plain")});$("#pausebutton").on("click",function(){pause()});
$("#newpoint").on("click",function(){var a=parseInt(document.getElementById("fromN").value),c=parseInt(document.getElementById("fromM").value),b=parseInt(document.getElementById("toN").value),d=parseInt(document.getElementById("toM").value),e=parseInt(document.getElementById("delay").value);addPath(a,c,b,d,e)&&(document.getElementById("points").hidden=!1,document.getElementById("points").innerHTML="",document.getElementById("points").appendChild(makeUL(paths)));document.getElementById("fromN").value=
"";document.getElementById("fromM").value="";document.getElementById("toM").value="";document.getElementById("toN").value="";draw()});
$("#randomgraph").on("click",function(){var a=parseInt(document.getElementById("minlen").value),c=parseInt(document.getElementById("amount").value),b=parseInt(document.getElementById("delay").value);randomgr(a,c,b)&&(document.getElementById("points").hidden=!1,document.getElementById("points").innerHTML="",document.getElementById("points").appendChild(makeUL(paths)));document.getElementById("minlen").value="";document.getElementById("amount").value="";document.getElementById("delay").value="";draw()});
function pathFinding(){graph&&null!=graph?(createcharts(),drawSpeed=Math.ceil(drawSpeed),drawint=setInterval(function(){paused?0:draw()},drawSpeed),stepint=setInterval(function(){paused||(movepoints(),charting(),step++,console.log("step "+step));document.getElementById("points").hidden=!1;document.getElementById("points").innerHTML="";document.getElementById("points").appendChild(makeUL(paths))},stepSpeed)):(rows=parseInt(document.getElementById("nimput").value),cols=parseInt(document.getElementById("minput").value),
BLOCKEDPERCENT=parseFloat(document.getElementById("BLOCKEDPERCENT").value),0<rows&&0<cols&&0<=BLOCKEDPERCENT&&1>=BLOCKEDPERCENT&&(graph=createGraph(rows,cols,BLOCKEDPERCENT),pathFinding()))}
function createcharts(){myChartx1=new Chart(chartx1,{type:"line",data:{labels:[],datasets:[{label:"Load",data:[],backgroundColor:["rgba(255, 99, 132, 0.2)"],borderColor:["rgba(255,99,132,1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}});myChartx2=new Chart(chartx2,{type:"line",data:{labels:[],datasets:[{label:"avg speed drop",data:[],backgroundColor:["rgba(80, 220, 100, 0.2)"],borderColor:["rgba(80, 220, 100 , 1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}});
myChartx3=new Chart(chartx3,{type:"line",data:{labels:[],datasets:[{label:"lost",backgroundColor:"rgba(255,0,0,0.2)",borderColor:"rgba(255,0,0,1)",data:[],fill:!1},{label:"cons",fill:!1,backgroundColor:"rgba(0,0,255,0.2)",borderColor:"rgba(0,0,255,1)",data:[]}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}
function charting(){for(var a=0,c=0,b=0,d=loses=0;d<points.length;d++)1>points[d].delay&&!points[d].ended&&(b++,a+=Math.round(100*paths[d].path.length/(paths[d].path.length+points[d].lost))/100),loses+=points[d].lost,c+=points[d].con;a/=b;addData(myChartx1,step,b/graph.nodes.length);addData(myChartx2,step,-1*(1-a));addDataMultiple(myChartx3,step,loses,c)}function addData(a,c,b){a.data.labels.push(c);a.data.datasets.forEach(function(a){a.data.push(b)});a.update()}
function addDataMultiple(a,c,b,d){a.data.labels.push(c);a.data.datasets[0].data.push(b);a.data.datasets[1].data.push(d);a.update()}
function movepoints(){graph.nodes.forEach(function(a){a.bids=[]});for(var a=0;a<points.length;a++)0<points[a].delay?points[a].delay--:(points[a].x=points[a].tox,points[a].y=points[a].toy,points[a].xc=points[a].toxc,points[a].yc=points[a].toyc,paths[a].path[points[a].currstp+1]?graph.grid[paths[a].path[points[a].currstp+1].x][paths[a].path[points[a].currstp+1].y].bids.push(a):points[a].ended=!0);graph.nodes.forEach(function(a){var b=null;1==a.bids.length&&(b=a.bids[0]);if(1<a.bids.length){b=a.bids[Math.floor(a.bids.length*
Math.random())];for(var c=0;c<a.bids.length;c++)points[a.bids[c]].con++,a.bids[c]!=b?points[a.bids[c]].lost++:0}null!=b&&(points[b].tox=paths[b].path[points[b].currstp+1].x,points[b].toy=paths[b].path[points[b].currstp+1].y,points[b].toxc=points[b].tox*xoffset+xoffset/2,points[b].toyc=points[b].toy*yoffset+yoffset/2,points[b].currstp++)})}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);drawLinks(graph);drawPath(paths);drawPoints();drawGraph(graph);drawNames(graph);animatepoints()}
function init(){cleanup();cols=rows=15;BLOCKEDPERCENT=0;graph=createGraph(rows,cols,BLOCKEDPERCENT);addPath(4,4,4,12);addPath(3,2,9,2);addPath(4,3,4,0);addPath(4,10,4,0);addPath(0,0,9,9);addPath(5,9,9,9);addPath(14,4,4,14);addPath(9,9,0,9);document.getElementById("points").hidden=!1;document.getElementById("points").innerHTML="";document.getElementById("points").appendChild(makeUL(paths));pathFinding()}
function randomgr(a,c,b){if(!(1>a||1>c||0>b)){rows=Math.floor(15*Math.random())+5;cols=Math.floor(15*Math.random())+5;BLOCKEDPERCENT=.5*Math.random();graph=createGraph(rows,cols,BLOCKEDPERCENT);for(var d=0;paths.length<c&&1E3>d;)addPath(Math.floor(cols*Math.random()),Math.floor(rows*Math.random()),Math.floor(cols*Math.random()),Math.floor(rows*Math.random()),b*Math.random())?paths[paths.length-1].path.length<a&&(points.pop(),paths.pop()):d++;document.getElementById("points").hidden=!1;document.getElementById("points").innerHTML=
"";document.getElementById("points").appendChild(makeUL(paths));pathFinding();return!0}}
function addPath(a,c,b,d,e){e=parseInt(e);if(!e||0>e)e=0;if(a<rows&&0<=a&&c<cols&&0<=c&&b<rows&&0<=b&&d<cols&&0<=d&&0<graph.grid[a][c].weight&&0<graph.grid[b][d].weight){var f=astar.search(graph,graph.grid[a][c],graph.grid[b][d]);if(f[0]){var g=getRandomColor();points.push({pthnmr:paths.length,x:a,y:c,color:g,currstp:0,ended:!1,xc:a*xoffset+xoffset/2,yc:c*yoffset+yoffset/2,toxc:a*xoffset+xoffset/2,toyc:c*yoffset+yoffset/2,tox:a,toy:c,lost:0,con:0,delay:e});paths.push({fromN:a,fromM:c,toN:b,toM:d,
path:f,color:g});return!0}}return!1}
function createGraph(a,c,b){var d=[];if(0<=b&&1>b&&0<a&&0<c){xoffset=canvas.width/a;yoffset=canvas.height/c;yVelocity=Math.ceil(drawSpeed/yoffset);xVelocity=Math.ceil(drawSpeed/xoffset);for(var e=0;e<a;e++){for(var f=[],g=0;g<c;g++)f.push(Math.random()>b?1:0);d.push(f)}document.getElementById("updatebutton").disabled=!1;document.getElementById("newpoint").disabled=!1;document.getElementById("pointdev").hidden=!1;document.getElementById("options").hidden=!1;return new Graph(d,{diagonal:diagonal_state})}return null}
function cleanup(){paths=[];points=[];graph=0;drawint&&clearInterval(drawint);stepint&&clearInterval(stepint)}function drawPath(a){a.forEach(function(a){for(var b=0;b<a.path.length-1;b++)ctx.beginPath(),ctx.moveTo(a.path[b].x*xoffset+xoffset/2,a.path[b].y*yoffset+yoffset/2),ctx.lineTo(a.path[b+1].x*xoffset+xoffset/2,a.path[b+1].y*yoffset+yoffset/2),ctx.strokeStyle=a.color,ctx.lineWidth=5,ctx.stroke(),ctx.closePath()})}
function drawLinks(a){for(var c=0;c<a.nodes.length;c++)if(0<a.nodes[c].weight)for(var b=a.nodes[c].x*xoffset+xoffset/2,d=a.nodes[c].y*yoffset+yoffset/2,e=a.neighbors(a.nodes[c]),f=0;f<e.length;f++)0<e[f].weight&&(ctx.beginPath(),ctx.moveTo(b,d),ctx.lineTo(e[f].x*xoffset+xoffset/2,e[f].y*yoffset+yoffset/2),ctx.strokeStyle="#000",ctx.lineWidth=1,ctx.stroke(),ctx.closePath())}
function drawNames(a){for(var c=0;c<a.nodes.length;c++)if(0<a.nodes[c].weight){var b=a.nodes[c].x*xoffset+xoffset/2,d=a.nodes[c].y*yoffset+yoffset/2;ctx.font="10px Arial";ctx.fillStyle="#ffffff";ctx.textAlign="center";ctx.fillText(c,b,d+4);ctx.font="10px Arial";ctx.fillStyle="#000000";ctx.textAlign="center";ctx.fillText("("+a.nodes[c].x+", "+a.nodes[c].y+")",b,d+20)}}
function drawGraph(a){for(var c=0;c<a.nodes.length;c++)if(0<a.nodes[c].weight){var b=a.nodes[c].x*xoffset+xoffset/2,d=a.nodes[c].y*yoffset+yoffset/2;ctx.beginPath();ctx.arc(b,d,10,0,2*Math.PI,!1);ctx.fillStyle="#000000";ctx.fill();ctx.closePath()}}
function drawPoints(){for(var a=0;a<points.length;a++)0<points[a].delay||points[a].ended||(points[a].x==paths[a].toN&&points[a].y==paths[a].toM&&(ctx.beginPath(),ctx.arc(points[a].toxc,points[a].toyc,20,0,2*Math.PI,!1),ctx.fillStyle="#006600",ctx.fill(),ctx.closePath()),ctx.beginPath(),ctx.arc(points[a].xc,points[a].yc,15,0,2*Math.PI,!1),ctx.fillStyle=points[a].color,ctx.fill(),ctx.closePath())}
function animatepoints(){points.forEach(function(a){Math.abs(a.toxc-a.xc)>=xVelocity?a.toxc>a.xc?a.xc+=xVelocity:a.xc-=xVelocity:a.x=a.tox;Math.abs(a.toyc-a.yc)>=yVelocity?a.toyc>a.yc?a.yc+=yVelocity:a.yc-=yVelocity:a.y=a.toy})}function getRandomColor(){for(var a="#",c=0;6>c;c++)a+="123456789ABCDE"[Math.floor(14*Math.random())];return a}
function makeUL(a){for(var c=document.createElement("ul"),b=0;b<a.length;b++){var d=document.createElement("li"),e=document.createElement("div"),f=document.createElement("p");e.className="input-color";var g=document.createElement("div");g.className="color-box";g.style="background-color: "+a[b].color+";";f.appendChild(document.createTextNode("From ("+a[b].fromN+", "+a[b].fromM+") To ("+a[b].toN+", "+a[b].toM+") Lost = "+points[b].lost+", concur = "+points[b].con+", speed = "+Math.round(100*paths[b].path.length/
(paths[b].path.length+points[b].lost))/100));e.appendChild(f);e.appendChild(g);d.appendChild(e);c.appendChild(d)}return c}window.onkeydown=function(a){a=a.keyCode?a.keyCode:a.which;73===a&&init();80===a&&pause();83===a&&download(graph.grid,"json.txt","text/plain");71===a&&console.log(graph);82===a&&randomgr(10,10,5)};function pause(){paused=paused?!1:!0}
function download(a,c,b){if(a&&null!=a){var d=JSON.stringify(a);a=document.createElement("a");b=new Blob([d],{type:b});a.href=URL.createObjectURL(b);a.download=c;a.click()}}
function canvasClick(a){if(void 0!=a.pageX&&void 0!=a.pageY){var c=a.pageX;a=a.pageY}else c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;c-=canvas.offsetLeft;a-=canvas.offsetTop;c=Math.floor(c/xoffset);a=Math.floor(a/yoffset);graph.grid[c][a].weight=0<graph.grid[c][a].weight?0:1}
document.getElementById("import").onclick=function(){var a=document.getElementById("selectFiles").files;console.log(a);if(0>=a.length)return!1;var c=new FileReader;c.onload=function(a){var b=[];a=JSON.parse(a.target.result);console.log(a);rows=a.length;cols=a[0].length;xoffset=canvas.width/rows;yoffset=canvas.height/cols;yVelocity=Math.ceil(drawSpeed/yoffset);xVelocity=Math.ceil(drawSpeed/xoffset);for(var c=0;c<rows;c++){for(var f=[],g=0;g<cols;g++)f.push(a[c][g].weight);b.push(f)}console.log(b);
document.getElementById("updatebutton").disabled=!1;document.getElementById("newpoint").disabled=!1;document.getElementById("pointdev").hidden=!1;document.getElementById("options").hidden=!1;graph=new Graph(b);pathFinding()};c.readAsText(a.item(0))};
$("#checkb1").click(function(){$(this).is(":checked")?(document.getElementById("checkb2").checked=!0,diagonal_state=document.getElementById("checkb3").checked=!0):(diagonal_state=!1,document.getElementById("checkb2").checked=!1,document.getElementById("checkb3").checked=!1)});
$("#checkb2").click(function(){$(this).is(":checked")?(document.getElementById("checkb1").checked=!0,diagonal_state=document.getElementById("checkb3").checked=!0):(diagonal_state=!1,document.getElementById("checkb1").checked=!1,document.getElementById("checkb3").checked=!1)});
$("#checkb3").click(function(){$(this).is(":checked")?(document.getElementById("checkb2").checked=!0,diagonal_state=document.getElementById("checkb1").checked=!0):(diagonal_state=!1,document.getElementById("checkb2").checked=!1,document.getElementById("checkb1").checked=!1)});
