(function(k){"object"===typeof module&&"object"===typeof module.exports?module.exports=k():"function"===typeof define&&define.amd?define([],k):(k=k(),window.astar=k.astar,window.Graph=k.Graph)})(function(){function k(a){for(var b=[];a.parent;)b.unshift(a),a=a.parent;b.unshift(a);return b}function t(){return new n(function(a){return a.f})}function l(a,b){b=b||{};this.nodes=[];this.diagonal=!!b.diagonal;this.grid=[];for(b=0;b<a.length;b++){this.grid[b]=[];for(var c=0,d=a[b];c<d.length;c++){var f=new m(b,
c,d[c]);this.grid[b][c]=f;this.nodes.push(f)}}this.init()}function m(a,b,c){this.x=a;this.y=b;this.weight=c;this.bids=[];this.owner=null}function n(a){this.content=[];this.scoreFunction=a}var p={search:function(a,b,c,d){a.cleanDirty();d=d||{};var f=d.heuristic||p.heuristics.manhattan;d=d.closest||!1;var g=t(),h=b;b.h=f(b,c);a.markDirty(b);for(g.push(b);0<g.size();){b=g.pop();if(b===c)return k(b);b.closed=!0;for(var l=a.neighbors(b),m=0,n=l.length;m<n;++m){var e=l[m];if(!e.closed&&!e.isWall()){var q=
b.g+e.getCost(b),r=e.visited;if(!r||q<e.g)e.visited=!0,e.parent=b,e.h=e.h||f(e,c),e.g=q,e.f=e.g+e.h,a.markDirty(e),d&&(e.h<h.h||e.h===h.h&&e.g<h.g)&&(h=e),r?g.rescoreElement(e):g.push(e)}}}return d?k(h):[]},heuristics:{manhattan:function(a,b){return Math.abs(b.x-a.x)+Math.abs(b.y-a.y)},diagonal:function(a,b){var c=Math.abs(b.x-a.x);a=Math.abs(b.y-a.y);return 1*(c+a)+(Math.sqrt(2)-2)*Math.min(c,a)}},cleanNode:function(a){a.f=0;a.g=0;a.h=0;a.visited=!1;a.closed=!1;a.parent=null}};l.prototype.init=function(){this.dirtyNodes=
[];for(var a=0;a<this.nodes.length;a++)p.cleanNode(this.nodes[a])};l.prototype.cleanDirty=function(){for(var a=0;a<this.dirtyNodes.length;a++)p.cleanNode(this.dirtyNodes[a]);this.dirtyNodes=[]};l.prototype.markDirty=function(a){this.dirtyNodes.push(a)};l.prototype.neighbors=function(a){var b=[],c=a.x;a=a.y;var d=this.grid;d[c-1]&&d[c-1][a]&&b.push(d[c-1][a]);d[c+1]&&d[c+1][a]&&b.push(d[c+1][a]);d[c]&&d[c][a-1]&&b.push(d[c][a-1]);d[c]&&d[c][a+1]&&b.push(d[c][a+1]);this.diagonal&&(d[c-1]&&d[c-1][a-
1]&&b.push(d[c-1][a-1]),d[c+1]&&d[c+1][a-1]&&b.push(d[c+1][a-1]),d[c-1]&&d[c-1][a+1]&&b.push(d[c-1][a+1]),d[c+1]&&d[c+1][a+1]&&b.push(d[c+1][a+1]));return b};l.prototype.toString=function(){for(var a=[],b=this.grid,c=0;c<b.length;c++){for(var d=[],f=b[c],g=0;g<f.length;g++)d.push(f[g].weight);a.push(d.join(" "))}return a.join("\n")};m.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};m.prototype.getCost=function(a){return a&&a.x!=this.x&&a.y!=this.y?1.41421*this.weight:this.weight};m.prototype.isWall=
function(){return 0===this.weight};n.prototype={push:function(a){this.content.push(a);this.sinkDown(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return a},remove:function(a){var b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(a){this.sinkDown(this.content.indexOf(a))},
sinkDown:function(a){for(var b=this.content[a];0<a;){var c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}},bubbleUp:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var f=a+1<<1,g=f-1,h=null;if(g<b){var k=this.scoreFunction(this.content[g]);k<d&&(h=g)}f<b&&this.scoreFunction(this.content[f])<(null===h?d:k)&&(h=f);if(null!==h)this.content[a]=this.content[h],this.content[h]=c,a=h;else break}}};
return{astar:p,Graph:l}});
